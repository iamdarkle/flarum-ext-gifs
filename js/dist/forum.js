(()=>{var t={195:(t,e,r)=>{t.exports=r(236)},236:t=>{var e=function(t){"use strict";var e,r=Object.prototype,n=r.hasOwnProperty,i="function"==typeof Symbol?Symbol:{},s=i.iterator||"@@iterator",o=i.asyncIterator||"@@asyncIterator",a=i.toStringTag||"@@toStringTag";function u(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{u({},"")}catch(t){u=function(t,e,r){return t[e]=r}}function c(t,e,r,n){var i=e&&e.prototype instanceof g?e:g,s=Object.create(i.prototype),o=new I(n||[]);return s._invoke=function(t,e,r){var n=l;return function(i,s){if(n===p)throw new Error("Generator is already running");if(n===d){if("throw"===i)throw s;return V()}for(r.method=i,r.arg=s;;){var o=r.delegate;if(o){var a=F(o,r);if(a){if(a===m)continue;return a}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(n===l)throw n=d,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n=p;var u=h(t,e,r);if("normal"===u.type){if(n=r.done?d:f,u.arg===m)continue;return{value:u.arg,done:r.done}}"throw"===u.type&&(n=d,r.method="throw",r.arg=u.arg)}}}(t,r,o),s}function h(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}t.wrap=c;var l="suspendedStart",f="suspendedYield",p="executing",d="completed",m={};function g(){}function v(){}function y(){}var w={};w[s]=function(){return this};var b=Object.getPrototypeOf,x=b&&b(b(j([])));x&&x!==r&&n.call(x,s)&&(w=x);var L=y.prototype=g.prototype=Object.create(w);function k(t){["next","throw","return"].forEach((function(e){u(t,e,(function(t){return this._invoke(e,t)}))}))}function E(t,e){function r(i,s,o,a){var u=h(t[i],t,s);if("throw"!==u.type){var c=u.arg,l=c.value;return l&&"object"==typeof l&&n.call(l,"__await")?e.resolve(l.__await).then((function(t){r("next",t,o,a)}),(function(t){r("throw",t,o,a)})):e.resolve(l).then((function(t){c.value=t,o(c)}),(function(t){return r("throw",t,o,a)}))}a(u.arg)}var i;this._invoke=function(t,n){function s(){return new e((function(e,i){r(t,n,e,i)}))}return i=i?i.then(s,s):s()}}function F(t,r){var n=t.iterator[r.method];if(n===e){if(r.delegate=null,"throw"===r.method){if(t.iterator.return&&(r.method="return",r.arg=e,F(t,r),"throw"===r.method))return m;r.method="throw",r.arg=new TypeError("The iterator does not provide a 'throw' method")}return m}var i=h(n,t.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,m;var s=i.arg;return s?s.done?(r[t.resultName]=s.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=e),r.delegate=null,m):s:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,m)}function B(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function T(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function I(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(B,this),this.reset(!0)}function j(t){if(t){var r=t[s];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var i=-1,o=function r(){for(;++i<t.length;)if(n.call(t,i))return r.value=t[i],r.done=!1,r;return r.value=e,r.done=!0,r};return o.next=o}}return{next:V}}function V(){return{value:e,done:!0}}return v.prototype=L.constructor=y,y.constructor=v,v.displayName=u(y,a,"GeneratorFunction"),t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===v||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,y):(t.__proto__=y,u(t,a,"GeneratorFunction")),t.prototype=Object.create(L),t},t.awrap=function(t){return{__await:t}},k(E.prototype),E.prototype[o]=function(){return this},t.AsyncIterator=E,t.async=function(e,r,n,i,s){void 0===s&&(s=Promise);var o=new E(c(e,r,n,i),s);return t.isGeneratorFunction(r)?o:o.next().then((function(t){return t.done?t.value:o.next()}))},k(L),u(L,a,"Generator"),L[s]=function(){return this},L.toString=function(){return"[object Generator]"},t.keys=function(t){var e=[];for(var r in t)e.push(r);return e.reverse(),function r(){for(;e.length;){var n=e.pop();if(n in t)return r.value=n,r.done=!1,r}return r.done=!0,r}},t.values=j,I.prototype={constructor:I,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(T),!t)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=e)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function i(n,i){return a.type="throw",a.arg=t,r.next=n,i&&(r.method="next",r.arg=e),!!i}for(var s=this.tryEntries.length-1;s>=0;--s){var o=this.tryEntries[s],a=o.completion;if("root"===o.tryLoc)return i("end");if(o.tryLoc<=this.prev){var u=n.call(o,"catchLoc"),c=n.call(o,"finallyLoc");if(u&&c){if(this.prev<o.catchLoc)return i(o.catchLoc,!0);if(this.prev<o.finallyLoc)return i(o.finallyLoc)}else if(u){if(this.prev<o.catchLoc)return i(o.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return i(o.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r];if(i.tryLoc<=this.prev&&n.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var s=i;break}}s&&("break"===t||"continue"===t)&&s.tryLoc<=e&&e<=s.finallyLoc&&(s=null);var o=s?s.completion:{};return o.type=t,o.arg=e,s?(this.method="next",this.next=s.finallyLoc,m):this.complete(o)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),m},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),T(r),m}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var i=n.arg;T(r)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(t,r,n){return this.delegate={iterator:j(t),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=e),m}},t}(t.exports);try{regeneratorRuntime=e}catch(t){Function("r","regeneratorRuntime = r")(e)}},718:(t,e,r)=>{"use strict";r.r(e),r.d(e,{extractGIF:()=>m,getGIFs:()=>l,getGIFsByIDs:()=>p,getLimit:()=>g,getTrendingGIFs:()=>c,getTrendingTerms:()=>a,initialize:()=>o});var n=r(456),i=r(195),s=r.n(i);function o(t,e){this.baseUrl="https://api.giphy.com/v1",this.defaultLimit=10,this.apiKey=t,this.rating="off"===e?"r":"low"===e?"pg-13":"medium"===e?"pg":"g"}function a(){return u.apply(this,arguments)}function u(){return(u=(0,n.Z)(s().mark((function t(){var e,r;return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=this.baseUrl+"/trending/searches?api_key="+this.apiKey,t.next=3,fetch(r).then((function(t){return t.json()})).then((function(t){void 0!==t.data?e=t.data:console.error("Sorry, there was something wrong with the Giphy API Key.")}));case 3:return t.abrupt("return",e);case 4:case"end":return t.stop()}}),t,this)})))).apply(this,arguments)}function c(t,e){return h.apply(this,arguments)}function h(){return(h=(0,n.Z)(s().mark((function t(e,r){var n,i,o=this;return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return i=this.baseUrl+"/gifs/trending?api_key="+this.apiKey+"&rating="+this.rating+"&limit="+(r||this.defaultLimit)+(e?"&offset="+e:""),t.next=3,fetch(i).then((function(t){return t.json()})).then((function(t){void 0!==t.data?n={gifs:t.data,next:e+(r||o.defaultLimit)}:console.error("Sorry, there was something wrong with the Tenor API Key.")}));case 3:return t.abrupt("return",n);case 4:case"end":return t.stop()}}),t,this)})))).apply(this,arguments)}function l(t,e,r){return f.apply(this,arguments)}function f(){return(f=(0,n.Z)(s().mark((function t(e,r,n){var i,o,a=this;return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return o=this.baseUrl+"/gifs/search?api_key="+this.apiKey+"&rating="+this.rating+"&q="+e+"&limit="+(n||this.defaultLimit)+(r?"&offset="+r:""),t.next=3,fetch(o).then((function(t){return t.json()})).then((function(t){void 0!==t.data?i={gifs:t.data,next:r+(n||a.defaultLimit)}:console.error("Sorry, there was something wrong with the Tenor API Key.")}));case 3:return t.abrupt("return",i);case 4:case"end":return t.stop()}}),t,this)})))).apply(this,arguments)}function p(t){return d.apply(this,arguments)}function d(){return(d=(0,n.Z)(s().mark((function t(e){var r,n;return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=this.baseUrl+"/gifs?api_key="+this.apiKey+"&ids="+e,t.next=3,fetch(n).then((function(t){return t.json()})).then((function(t){r=t.data}));case 3:return t.abrupt("return",r);case 4:case"end":return t.stop()}}),t,this)})))).apply(this,arguments)}function m(t){return{id:t.id,title:t.title,url:t.images.original.url}}function g(){return this.defaultLimit}},761:(t,e,r)=>{"use strict";r.r(e),r.d(e,{extractGIF:()=>m,getGIFs:()=>l,getGIFsByIDs:()=>p,getLimit:()=>g,getTrendingGIFs:()=>c,getTrendingTerms:()=>a,initialize:()=>o});var n=r(456),i=r(195),s=r.n(i);function o(t,e){this.baseUrl="https://g.tenor.com/v1",this.defaultLimit=10,this.apiKey=t,this.rating=e}function a(){return u.apply(this,arguments)}function u(){return(u=(0,n.Z)(s().mark((function t(){var e,r;return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=this.baseUrl+"/trending_terms?key="+this.apiKey,t.next=3,fetch(r).then((function(t){return t.json()})).then((function(t){void 0!==t.results?e=t.results:console.error("Sorry, there was something wrong with the Tenor API Key.")}));case 3:return t.abrupt("return",e);case 4:case"end":return t.stop()}}),t,this)})))).apply(this,arguments)}function c(t,e){return h.apply(this,arguments)}function h(){return(h=(0,n.Z)(s().mark((function t(e,r){var n,i;return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return i=this.baseUrl+"/trending?key="+this.apiKey+"&contentfilter="+this.rating+"&media_filter=minimal&limit="+(r||this.defaultLimit)+(e?"&pos="+e:""),t.next=3,fetch(i).then((function(t){return t.json()})).then((function(t){void 0!==t.results?n={gifs:t.results,next:t.next}:console.error("Sorry, there was something wrong with the Tenor API Key.")}));case 3:return t.abrupt("return",n);case 4:case"end":return t.stop()}}),t,this)})))).apply(this,arguments)}function l(t,e,r){return f.apply(this,arguments)}function f(){return(f=(0,n.Z)(s().mark((function t(e,r,n){var i,o;return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return o=this.baseUrl+"/search?key="+this.apiKey+"&q="+e+"&contentfilter="+this.rating+"&media_filter=minimal&limit="+(n||this.defaultLimit)+(r?"&pos="+r:""),t.next=3,fetch(o).then((function(t){return t.json()})).then((function(t){void 0!==t.results?i={gifs:t.results,next:t.next}:console.error("Sorry, there was something wrong with the Tenor API Key.")}));case 3:return t.abrupt("return",i);case 4:case"end":return t.stop()}}),t,this)})))).apply(this,arguments)}function p(t){return d.apply(this,arguments)}function d(){return(d=(0,n.Z)(s().mark((function t(e){var r,n;return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=this.baseUrl+"/gifs?key="+this.apiKey+"&ids="+e+"&media_filter=minimal",t.next=3,fetch(n).then((function(t){return t.json()})).then((function(t){r=t.results}));case 3:return t.abrupt("return",r);case 4:case"end":return t.stop()}}),t,this)})))).apply(this,arguments)}function m(t){return{id:t.id,title:t.title,url:t.media[0].gif.url}}function g(){return this.defaultLimit}},456:(t,e,r)=>{"use strict";function n(t,e,r,n,i,s,o){try{var a=t[s](o),u=a.value}catch(t){return void r(t)}a.done?e(u):Promise.resolve(u).then(n,i)}function i(t){return function(){var e=this,r=arguments;return new Promise((function(i,s){var o=t.apply(e,r);function a(t){n(o,i,s,a,u,"next",t)}function u(t){n(o,i,s,a,u,"throw",t)}a(void 0)}))}}r.d(e,{Z:()=>i})}},e={};function r(n){var i=e[n];if(void 0!==i)return i.exports;var s=e[n]={exports:{}};return t[n](s,s.exports,r),s.exports}r.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return r.d(e,{a:e}),e},r.d=(t,e)=>{for(var n in e)r.o(e,n)&&!r.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})},r.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})};var n={};(()=>{"use strict";r.r(n);const t=flarum.core.compat["common/extend"],e=flarum.core.compat["common/app"];var i=r.n(e);const s=flarum.core.compat["common/components/TextEditor"];var o=r.n(s);const a=flarum.core.compat["common/components/TextEditorButton"];var u=r.n(a),c=r(456);function h(t,e){return h=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},h(t,e)}function l(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,h(t,e)}var f=r(195),p=r.n(f);const d=flarum.core.compat.app;var g=r.n(d);const v=flarum.core.compat["common/components/Button"];var y=r.n(v);const w=flarum.core.compat["common/Component"];var b=r.n(w),x=function(t){function e(){return t.apply(this,arguments)||this}return l(e,t),e.prototype.view=function(){var t=this.attrs.attributes,e=t.title,r=t.url,n=t.icon,i=t.onclick;return m("div",{style:r&&"background-image: url("+r+")",onclick:i},n&&m("i",{class:n})," ",e)},e}(b());const L=flarum.core.compat["common/components/Modal"];var k=r.n(L);const E=flarum.core.compat["common/components/Tooltip"];var F=r.n(E),B="therealsujitk-gifs",T=function(t){function e(){return t.apply(this,arguments)||this}l(e,t);var r=e.prototype;return r.oninit=function(e){var r=this;t.prototype.oninit.call(this,e),this.loading=!1,this.hidden=!0,this.rowSpan=15*Math.random()+25,this.id,$(window).resize((function(){r.hidden||r.setRowSpan(r.$("img",r)[0])}))},r.view=function(){var t=this,e=this.attrs.attributes;this.id=e.id,this.favourite=e.favourite;var r=e.title,n=e.url,i=e.onclick;return e.isFavourite&&(this.hidden||this.setRowSpan(this.$("img",this)[0])),m("div",{style:this.rowSpan&&"grid-row-end: span "+Math.round(this.rowSpan)},m("img",{alt:r,src:n,style:this.hidden?"visibility: hidden":"",onclick:function(e){i(e,t.id)},onload:function(e){t.setRowSpan(e.target)}}),m(F(),{showOnFocus:!1,text:e.isFavourite?g().translator.trans(B+".forum.removeFavourite"):g().translator.trans(B+".forum.addFavourite")},m(y(),{className:"Button Button--icon hasIcon",style:this.hidden?"visibility: hidden":"",icon:this.loading?"":e.isFavourite?"fas fa-star":"far fa-star",loading:this.loading,onclick:this.handleFavourite.bind(this)})))},r.setRowSpan=function(t){this.rowSpan=t.height/5+2,this.hidden=!1},r.handleFavourite=function(){var t=(0,c.Z)(p().mark((function t(){return p().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.loading=!0,t.next=3,this.favourite(this.id);case 3:t.sent&&(this.attrs.attributes.isFavourite=!this.attrs.attributes.isFavourite),this.loading=!1,m.redraw();case 7:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}(),e}(b());const I=flarum.core.compat["common/utils/Stream"];var j=r.n(I),V="therealsujitk-gifs",P="tenor",_="home",G="favourite",R="trending",S="result",O=function(t){function e(){return t.apply(this,arguments)||this}l(e,t);var n=e.prototype;return n.oninit=function(e){t.prototype.oninit.call(this,e),this.textArea=this.attrs.textArea,this.baseUrl=g().forum.attribute("baseUrl"),this.engine=g().forum.attribute(V+".engine")||"giphy",this.apiKey=g().forum.attribute(V+".api_key"),this.rating=g().forum.attribute(V+".rating")||"off",this.Engine=this.getEngine(),this.Engine.initialize(this.apiKey,this.rating),this.isHomeVisible=!0,this.isFavouritesVisible=!1,this.isTrendingVisible=!1,this.isResultsVisible=!1,this.category="",this.query=j()(""),this.next=null,this.favourites=new Set,this.homeButtons=new Array,this.favouriteButtons=new Array,this.resultButtons=new Array,this.loadHomePage(),this.loadFavouritesPage(),this.loading=!1,this.reachedEnd=!1},n.className=function(){return V+"-modal"},n.title=function(){return"Select a GIF to add to your post"},n.content=function(){var t=this;return m("div",{className:"Modal-body"},m("div",{style:"display: flex;"},m(y(),{id:V+"-back-button",className:"Button Button--icon hasIcon",style:this.isHomeVisible?"display: none":"",icon:"fas fa-long-arrow-alt-left",onclick:this.showHome.bind(this)}),m("span",{id:V+"-category",style:this.isFavouritesVisible||this.isTrendingVisible?"":"display: none"},this.category&&this.category),m("div",{id:V+"-search-input",className:"Search-input",style:this.isHomeVisible||this.isResultsVisible?"":"display: none"},m("input",{className:"FormControl",placeholder:this.getPlaceholder(),value:this.query(),bidi:this.query,onkeydown:this.onkeydown.bind(this)})),m(y(),{id:V+"-search-button",className:"Button Button--primary",style:this.isHomeVisible||this.isResultsVisible?"":"display: none",onclick:function(){t.resetResultsPage(),t.loadResultsPage()}},g().translator.trans(V+".forum.search"))),m("div",{className:V+"-container",style:this.isHomeVisible?"":"display: none"},this.homeButtons&&this.homeButtons.map((function(t){return m(x,{attributes:t})}))),m("div",{className:V+"-container",style:this.isFavouritesVisible?"":"display: none",scrollTop:this.isTrendingVisible||this.isResultsVisible?"0":""},this.favouriteButtons&&this.favouriteButtons.map((function(t){return m(T,{attributes:t})})),m("span",{id:V+"-end"},"app.translator.trans(`$",V,".forum.reachedEnd`)")),m("div",{className:V+"-container",style:this.isTrendingVisible||this.isResultsVisible?"":"display: none",onscroll:this.loadMore.bind(this),scrollTop:this.isTrendingVisible||this.isResultsVisible?"0":""},this.resultButtons&&this.resultButtons.map((function(t){return m(T,{attributes:t})})),m("span",{id:V+"-end"},"app.translator.trans(`$",V,".forum.reachedEnd`)")),m("div",{id:V+"-footer"},m("img",{src:this.baseUrl+"/assets/extensions/therealsujitk-gifs/powered_by_"+this.engine+".svg"})))},n.getEngine=function(){return this.engine===P?r(761):r(718)},n.getPlaceholder=function(){return this.engine==P?g().translator.trans(V+".forum.searchTenor"):g().translator.trans(V+".forum.searchGiphy")},n.showHome=function(){this.isFavouritesVisible=!1,this.isTrendingVisible=!1,this.isResultsVisible=!1,this.isHomeVisible=!0,this.query(""),this.resetResultsPage()},n.showFavourites=function(){this.isHomeVisible=!1,this.isResultsVisible=!1,this.isTrendingVisible=!1,this.isFavouritesVisible=!0,this.category=g().translator.trans(V+".forum.favourites")},n.showTrending=function(){this.isHomeVisible=!1,this.isFavouritesVisible=!1,this.isResultsVisible=!1,this.isTrendingVisible=!0,this.category=g().translator.trans(V+".forum.trending")},n.showResults=function(){this.isHomeVisible=!1,this.isFavouritesVisible=!1,this.isTrendingVisible=!1,this.isResultsVisible=!0},n.loadHomePage=function(){var t=(0,c.Z)(p().mark((function t(){var e,r,n,i,s,o=this;return p().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e={title:g().translator.trans(V+".forum.favourites"),icon:"fas fa-star",onclick:function(){o.showFavourites()}},r={title:g().translator.trans(V+".forum.trending"),icon:"fas fa-chart-line",onclick:function(){o.loadTrendingPage()}},this.injectGIFs(null,1,_,1),this.homeButtons.push(e,r),t.next=6,this.Engine.getTrendingTerms();case 6:for(n=t.sent,i=0;i<n.length;++i)s={title:n[i],onclick:function(t){o.query(t.target.innerText),o.loadResultsPage()}},this.injectGIFs(n[i],this.homeButtons.length,_,1),this.homeButtons.push(s);case 8:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}(),n.loadFavouritesPage=function(){var t=(0,c.Z)(p().mark((function t(){var e=this;return p().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:g().store.find(V).then((function(t){var r="";t.forEach((function(t){var n=t.data.attributes.gifID;r=""+r+n+",",e.favouriteButtons.push({}),e.favourites.add(n)})),r=r.slice(0,-1),t.length&&e.injectGIFs(r,0,G,t.length)}));case 1:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),n.loadTrendingPage=function(){var t=(0,c.Z)(p().mark((function t(){var e,r,n;return p().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:for(this.showTrending(),e=0;e<this.Engine.getLimit();++e)r={},this.resultButtons.push(r);n=this.resultButtons.length-this.Engine.getLimit(),this.injectGIFs(null,n,R,null),this.loading=!1;case 5:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}(),n.loadResultsPage=function(){var t=(0,c.Z)(p().mark((function t(){var e,r,n;return p().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:for(this.showResults(),e=0;e<this.Engine.getLimit();++e)r={},this.resultButtons.push(r);n=this.resultButtons.length-this.Engine.getLimit(),this.injectGIFs(this.query(),n,S,null),this.loading=!1;case 5:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}(),n.resetResultsPage=function(){this.resultButtons=new Array,m.redraw.sync(),this.next=null,this.reachedEnd=!1},n.loadMore=function(t){if((this.isResultsVisible||this.isTrendingVisible)&&!this.loading&&!this.reachedEnd){var e=t.target.scrollTop,r=t.target.scrollHeight-t.target.offsetHeight;0!=r&&e>=r-200&&(this.loading=!0,this.isResultsVisible?this.loadResultsPage():this.loadTrendingPage())}},n.injectGIFs=function(){var t=(0,c.Z)(p().mark((function t(e,r,n,i){var s,o,a,u,h,l=this;return p().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n!==G){t.next=6;break}return t.next=3,this.Engine.getGIFsByIDs(e);case 3:s=t.sent,t.next=19;break;case 6:if(n!==R&&null!=e){t.next=14;break}return t.next=9,this.Engine.getTrendingGIFs(this.next,i);case 9:o=t.sent,s=o.gifs,!i&&(this.next=o.next),t.next=19;break;case 14:return t.next=16,this.Engine.getGIFs(e,this.next,i);case 16:o=t.sent,s=o.gifs,!i&&(this.next=o.next);case 19:a=0;case 20:if(!(a<(i||this.Engine.getLimit()))){t.next=36;break}if(void 0!==s[a]){t.next=24;break}return n===G?this.favouriteButtons.splice(r+a):n===S&&(this.resultButtons.splice(r+a),this.reachedEnd=!0),t.abrupt("break",36);case 24:u=this.Engine.extractGIF(s[a]),(h={}).id=u.id,h.title=u.title,h.url=u.url,h.isFavourite=this.favourites.has(u.id),h.onclick=function(t,e){var r=t.target.alt,n=t.target.src,i="!["+l.engine[0].toUpperCase()+l.engine.slice(1)+" - "+r+"]("+n+")";l.textArea.insertAtCursor(i),g().modal.close(),l.engine===P&&(n="https://g.tenor.com/v1/registershare?&key="+l.apiKey+(""!=l.query()?"&q="+l.query():"")+"&id="+e,fetch(n))},h.favourite=function(){var t=(0,c.Z)(p().mark((function t(e){var r;return p().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=!1,!l.favourites.has(e)){t.next=6;break}return t.next=4,g().request({method:"DELETE",url:g().forum.attribute("apiUrl")+"/"+V+"/"+e}).then((function(){var t=l.favouriteButtons.findIndex((function(t){return t.id===e}));l.favouriteButtons.splice(t,1),l.favourites.delete(e),0==l.favouriteButtons.length?delete l.homeButtons[0].url:l.homeButtons[0].url=l.favouriteButtons[0].url,r=!0}));case 4:t.next=8;break;case 6:return t.next=8,g().store.createRecord(V).save({gifID:e}).then((function(){l.injectGIFs(e,0,G,1),l.favourites.add(e),r=!0}));case 8:return t.abrupt("return",r);case 9:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),n===_?this.homeButtons[r+a].url=u.url:n===G?(this.favouriteButtons[r+a]&&void 0===this.favouriteButtons[r+a].url?Object.assign(this.favouriteButtons[r+a],h):this.favouriteButtons.unshift(h),r+a==0&&(this.homeButtons[0].url=u.url)):Object.assign(this.resultButtons[r+a],h);case 33:++a,t.next=20;break;case 36:m.redraw();case 37:case"end":return t.stop()}}),t,this)})));return function(e,r,n,i){return t.apply(this,arguments)}}(),n.onsubmit=function(t){t.preventDefault()},n.onkeydown=function(t){"Enter"===t.key&&(this.query(this.query().trim()),""===this.query()?this.showHome():(this.resetResultsPage(),this.loadResultsPage()))},e}(k());const K=flarum.core.compat.Model;var N=r.n(K),Z=function(t){function e(){for(var e,r=arguments.length,n=new Array(r),i=0;i<r;i++)n[i]=arguments[i];return(e=t.call.apply(t,[this].concat(n))||this).gifID=N().attribute("gifID"),e}return l(e,t),e}(N()),A="therealsujitk-gifs";i().initializers.add(A,(function(){i().store.models[A]=Z,(0,t.extend)(o().prototype,"toolbarItems",(function(t){var e=this;t.add("my-item",m(u(),{id:A+"-toolbar-item",className:"Button Button--icon Button--link hasIcon",title:i().translator.trans(A+".forum.label"),onclick:function(){return i().modal.show(O,{textArea:e.attrs.composer.editor})}},m("svg",{id:"therealsujitk-gifs-toolbar-item",xmlns:"http://www.w3.org/2000/svg",xlink:"http://www.w3.org/1999/xlink",width:"16pt",height:"7pt",viewBox:"0 0 16 7",version:"1.1"},m("g",null,m("path",{d:"M 0.78125 7.042969 C 0.496094 6.933594 0.265625 6.738281 0.132812 6.480469 L 0 6.234375 L 0 0.875 L 0.132812 0.625 C 0.277344 0.355469 0.558594 0.128906 0.847656 0.0429688 C 0.957031 0.015625 1.71875 0 2.917969 0.0078125 L 4.808594 0.0234375 L 5.050781 0.15625 C 5.21875 0.246094 5.332031 0.355469 5.425781 0.511719 C 5.597656 0.800781 5.648438 0.992188 5.648438 1.410156 L 5.648438 1.753906 L 1.65625 1.753906 L 1.65625 5.355469 L 3.96875 5.355469 L 3.96875 3.554688 L 5.648438 3.554688 L 5.648438 4.800781 C 5.648438 5.484375 5.628906 6.117188 5.605469 6.207031 C 5.523438 6.527344 5.308594 6.808594 5.050781 6.953125 L 4.808594 7.085938 L 2.878906 7.09375 C 1.339844 7.105469 0.917969 7.09375 0.78125 7.042969 Z M 0.78125 7.042969",fill:"currentColor"}),m("path",{d:"M 7.371094 3.554688 L 7.371094 0 L 9.050781 0 L 9.050781 7.109375 L 7.371094 7.109375 Z M 7.371094 3.554688",fill:"currentColor"}),m("path",{d:"M 10.773438 3.554688 L 10.773438 0 L 15.855469 0 L 15.855469 1.753906 L 12.453125 1.753906 L 12.453125 2.988281 L 14.722656 2.988281 L 14.722656 4.742188 L 12.453125 4.742188 L 12.453125 7.109375 L 10.773438 7.109375 Z M 10.773438 3.554688",fill:"currentColor"})))))}))}))})(),module.exports=n})();
//# sourceMappingURL=forum.js.map